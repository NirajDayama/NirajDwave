<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Optimization Problem with quantum computing</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        // Configure MathJax to correctly identify the display math delimiters ($$)
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        /* Custom font import for a professional look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc; /* Light background */
            color: #1f2937;
        }
        .section-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            padding: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
        }
        .code-block {
            background-color: #111827; /* Dark background for code */
            color: #d1d5db;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: monospace;
            font-size: 0.85rem;
            margin-top: 0.75rem;
        }
        .highlight {
            color: #3b82f6; /* Blue highlight */
            font-weight: 600;
        }
        /* Custom table styling */
        .result-table th, .result-table td {
            padding: 0.5rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .result-table th {
            background-color: #eff6ff; /* Light blue header */
            font-weight: 600;
            color: #1e40af;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-extrabold text-blue-900 mb-2">Hybrid Quantum Portfolio Optimization</h1>
        <p class="text-xl text-gray-600">CQM & NL Solvers: From Classic Markowitz to Real-World Constraints</p>
        <div class="h-1 bg-blue-500 w-24 mx-auto mt-4 rounded-full"></div>
    </header>

    <div class="grid grid-cols-1 gap-6">

        <div class="section-card" id="section-1">
            <h2 class="text-2xl font-bold mb-3 text-blue-700">1. The Classic Portfolio Problem (Recap)</h2>
            <p class="text-gray-700">
                The foundational <strong>Markowitz Mean-Variance</strong> optimization seeks to minimize investment <strong>risk (variance)</strong> for a given level of expected <strong>return</strong>. Since the audience is conversant, this is simply a quadratic problem:
            </p>
            <div class="code-block text-center text-lg !bg-gray-500">
                $$ \text{Minimize Risk: } \sum_{i,j} w_i w_j \sigma_{i,j} $$
                $$ \text{Subject to: } \sum_{i} w_i R_i \ge R_{\text{target}} $$ and $$ \sum_{i} w_i = 1 $$
            </div>
            <p class="mt-3 text-gray-700">
                Here, $w_i$ are the continuous portfolio weights, $\Sigma$ is the covariance matrix, and $R_i$ are the asset returns.
            </p>
        </div>

        <div class="section-card" id="section-2">
            <h2 class="text-2xl font-bold mb-3 text-blue-700">2. Minimal Instance: 10 Assets, No Side Constraints</h2>
            <p class="text-gray-700">
                We simplify the problem for hybrid solvers by using <strong>Integer Discretization</strong>. Instead of continuous weights ($w_i$), we use integer weights ($W_i$) scaled by a factor of 100 ($W_i \in [0, 100]$).
            </p>
            <ul class="list-disc list-inside text-gray-700 pl-4">
                <li><span class="highlight">Assets:</span> 10, each with unique $\mathbf{R_i}$ and $\mathbf{\Sigma_{i,j}}$.</li>
                <li><span class="highlight">Discretization:</span> $\mathbf{W_i \in \{0, 1, \dots, 100\}}$ (1% granularity).</li>
                <li><span class="highlight">Budget Constraint:</span> $\mathbf{\sum W_i = 100}$.</li>
                <li><span class="highlight">Target Return:</span> $\mathbf{5\%}$ (or 5.0 in scaled integer units).</li>
            </ul>
            <p class="mt-3 text-gray-700">
                This integer-constrained quadratic model is directly solvable by D-Wave's hybrid solvers.
            </p>
        </div>

        <div class="section-card" id="section-3">
            <h2 class="text-2xl font-bold mb-3 text-red-700">3. Implementation in CQM (Constrained Quadratic Model)</h2>
            <p class="text-gray-700">
                The CQM framework is explicitly designed for this type of problem. The variables are defined as integers with clear bounds, and the objective is built by multiplying the variable objects.
            </p>
            <div class="code-block">
                <p class="text-yellow-400">// Variable Definition (Correct Style)</p>
                <code class="block">
                    W = []<br>
                    for i in range(NUM_ASSETS):<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;w_i = cqm.add_variable(dimod.INTEGER, f'W_{i+1}', lower_bound=0, upper_bound=100)<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;W.append(w_i)
                </code>
                <p class="text-yellow-400 mt-3">// Objective Function (Risk Minimization)</p>
                <code class="block">
                    objective = 0<br>
                    for i in range(NUM_ASSETS):<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;for j in range(NUM_ASSETS):<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objective += W[i] * W[j] * SIGMAS[i, j]
                </code>
            </div>
        </div>

        <div class="section-card" id="section-4">
            <h2 class="text-2xl font-bold mb-3 text-red-700">4. Implementation in NL (Non-Linear Solver)</h2>
            <p class="text-gray-700">
                The NL framework is simpler for mathematical expression and is often preferred for problems dominated by linear and quadratic terms.
            </p>
            <div class="code-block">
                <p class="text-yellow-400">// Variable Definition</p>
                <code class="block">
                    model = Model.from_problem('<br>
                    &nbsp;&nbsp;variables:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;W_1, W_2, ..., W_10 integer [0..100]<br>
                    ')
                </code>
                <p class="text-yellow-400 mt-3">// Constraints and Objective</p>
                <code class="block">
                    # Budget: All weights must sum to 100<br>
                    model.constraint.add('W_1 + ... + W_10 = 100')<br><br>
                    # Objective: Minimize the quadratic risk term<br>
                    model.minimize('W_1*W_1*Sigma_11 + ... + W_i*W_j*Sigma_ij + ...')
                </code>
            </div>
            <p class="mt-3 text-gray-700">
                While the syntax is simpler, the core logic of defining integer variables and minimizing a quadratic expression remains identical to CQM.
            </p>
        </div>

        <div class="section-card" id="section-5">
            <h2 class="text-2xl font-bold mb-3 text-green-700">5. Results: Classic Minimal Portfolio (CQM & NL)</h2>
            <p class="text-gray-700 mb-4">
                In the classic minimal problem, the solver has maximum flexibility to minimize risk. Since it can set any $W_i$ to zero, the result typically concentrates weight in the few assets that offer the best return-to-risk ratio.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Summary Metrics</h3>
                    <ul class="list-none space-y-1 text-gray-800">
                        <li><span class="highlight">Optimal Risk:</span> <span class="text-green-600">0.000298</span></li>
                        <li><span class="highlight">Achieved Return:</span> <span class="text-green-600">5.65%</span> (Target $\ge 5\%$)</li>
                        <li><span class="highlight">Assets Used:</span> 3 / 10</li>
                    </ul>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Optimal Allocation (Mock Data)</h3>
                    <table class="w-full text-sm result-table">
                        <thead><tr><th>Asset</th><th>Weight ($W_i$)</th><th>Actual %</th></tr></thead>
                        <tbody>
                            <tr><td>Asset 3</td><td>30</td><td>30%</td></tr>
                            <tr><td>Asset 5</td><td>35</td><td>35%</td></tr>
                            <tr><td>Asset 8</td><td>35</td><td>35%</td></tr>
                            <tr><td>Others</td><td>0</td><td>0%</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="mt-4 text-gray-700 italic border-l-4 border-green-500 pl-3">
                <span class="font-bold">Key Insight:</span> The optimal allocation is highly concentrated, leading to minimal theoretical risk. This is often impractical in real-world finance due to regulatory or diversification needs.
            </p>
        </div>

        <div class="section-card" id="section-6">
            <h2 class="text-2xl font-bold mb-3 text-blue-700">6. Portfolio Optimization with Side Constraints</h2>
            <p class="text-gray-700">
                To move from the theoretical "classic" model to a real-world implementable portfolio, we add <strong>side constraints</strong>. These force diversification and adherence to regulatory or fund mandates.
            </p>
            <ul class="list-disc list-inside text-gray-700 pl-4 space-y-2">
                <li><span class="highlight">Granularity Constraint:</span> Each position must be between $\mathbf{2\%}$ and $\mathbf{30\%}$ ($W_i \in [2, 30]$). This forces diversification and limits single-asset exposure.</li>
                <li><span class="highlight">Sector Limit (S1):</span> Max $\mathbf{60\%}$ exposure in Sector 1 (Assets 1-5).</li>
                <li><span class="highlight">Sector Limit (S2):</span> Max $\mathbf{60\%}$ exposure in Sector 2 (Assets 6-10).</li>
            </ul>
            <p class="mt-3 text-gray-700">
                The objective function (risk minimization) remains the same, but the feasible space is drastically reduced.
            </p>
        </div>

        <div class="section-card" id="section-7">
            <h2 class="text-2xl font-bold mb-3 text-red-700">7. Implementation of Side Constraints in NL Solver</h2>
            <p class="text-gray-700">
                In the NL framework, side constraints are integrated either through variable bounds (for position limits) or additional linear constraints (for sector limits).
            </p>
            <div class="code-block">
                <p class="text-yellow-400">// Granularity via Variable Bounds</p>
                <code class="block">
                    model = Model.from_problem('<br>
                    &nbsp;&nbsp;variables:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;W_1, W_2, ..., W_10 integer [2..30]<br>
                    ') # Bounds changed from [0..100] to [2..30]
                </code>
                <p class="text-yellow-400 mt-3">// Sector Exposure Constraint</p>
                <code class="block">
                    # Sector 1 Constraint (Assets 1-5, Max 60%)<br>
                    model.constraint.add('W_1 + W_2 + W_3 + W_4 + W_5 <= 60')<br>
                    # Sector 2 Constraint (Assets 6-10, Max 60%)<br>
                    model.constraint.add('W_6 + W_7 + W_8 + W_9 + W_10 <= 60')
                </code>
            </div>
            <p class="mt-3 text-gray-700">
                The hybrid solver efficiently handles this combination of quadratic objective and multiple linear integer constraints.
            </p>
        </div>

        <div class="section-card" id="section-8">
             <h2 class="text-2xl font-bold mb-3 text-green-700">8. Results: Full Problem (NL Solver)</h2>
            <p class="text-gray-700 mb-4">
                The introduction of side constraints forces the solver to explore solutions with broader diversification. This typically results in a slightly higher minimal risk, as the ideal, highly concentrated solution is no longer feasible.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Summary Metrics</h3>
                    <ul class="list-none space-y-1 text-gray-800">
                        <li><span class="highlight">Optimal Risk:</span> <span class="text-red-600">0.000371</span> (Increased from 0.000298)</li>
                        <li><span class="highlight">Achieved Return:</span> <span class="text-green-600">5.02%</span> (Target $\ge 5\%$)</li>
                        <li><span class="highlight">Assets Used:</span> 7 / 10</li>
                    </ul>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Optimal Allocation (Mock Data)</h3>
                    <table class="w-full text-sm result-table">
                        <thead><tr><th>Asset</th><th>Weight ($W_i$)</th><th>Actual %</th></tr></thead>
                        <tbody>
                            <tr><td>Asset 1, 6, 7</td><td>15, 2, 2</td><td>19%</td></tr>
                            <tr><td>Asset 2, 3, 5</td><td>18, 16, 17</td><td>51%</td></tr>
                            <tr><td>Asset 4, 8, 9, 10</td><td>30</td><td>30%</td></tr>
                            <tr><td colspan="3" class="text-center font-bold">Total: 7 Assets Used | Sector 1: 51% | Sector 2: 49%</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="mt-4 text-gray-700 italic border-l-4 border-red-500 pl-3">
                <span class="font-bold">Key Insight:</span> The solver must now allocate to a wider set of assets to satisfy the minimum position size (2%), increasing the minimum achievable risk but providing a <strong>real-world, diversified</strong> solution.
                <br><br>
                <span class="font-bold">Note to User:</span> This result data is illustrative. Different executions on the DWave annealer get different results every time.
            </p>
        </div>

        <div class="section-card" id="section-9">
             <h2 class="text-2xl font-bold mb-3 text-purple-700">9. Future Plans: Expanding the Model Complexity</h2>
            <p class="text-gray-700">
                Building on this robust implementation, future work can increase the complexity to further match real-world trading environments:
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                <div class="p-3 bg-purple-50 rounded-lg">
                    <h3 class="font-semibold text-lg text-purple-800">1. Transaction Costs (T/C)</h3>
                    <p class="text-sm text-gray-700 mt-1">
                        Introduce a $\mathbf{Binary}$ variable ($Y_i$) that is 1 if $W_i > 0$. The objective then minimizes risk plus $\sum T_i Y_i$. This turns the problem into a Mixed-Integer Quadratic Program (MIQP).
                    </p>
                </div>
                <div class="p-3 bg-purple-50 rounded-lg">
                    <h3 class="font-semibold text-lg text-purple-800">2. Downside Risk (CVaR)</h3>
                    <p class="text-sm text-gray-700 mt-1">
                        Move beyond variance-based risk (which penalizes upside movement) to minimizing <strong>Conditional Value at Risk (CVaR)</strong>. This requires adding linear constraints and continuous variables to approximate the tail risk, fitting well within the hybrid CQM/NL framework.
                    </p>
                </div>
                <div class="p-3 bg-purple-50 rounded-lg">
                    <h3 class="font-semibold text-lg text-purple-800">3. Multi-Period Modeling</h3>
                    <p class="text-sm text-gray-700 mt-1">
                        Implement a <strong>multi-period model</strong> where today's decision ($W_i^t$) is constrained by yesterday's ($W_i^{t-1}$) due to rebalancing costs. This increases the total number of variables significantly but is scalable on hybrid solvers.
                    </p>
                </div>
            </div>
        </div>
    </div>

</body>
</html>